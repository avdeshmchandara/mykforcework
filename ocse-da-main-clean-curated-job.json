{
	"jobConfig": {
		"name": "ocse-da-main-clean-curated-job",
		"description": "",
		"role": "arn:aws:iam::884666078658:role/OcseDaMainGlueServiceRole",
		"command": "glueetl",
		"version": "4.0",
		"runtime": null,
		"workerType": "G.1X",
		"numberOfWorkers": 10,
		"maxCapacity": 10,
		"maxRetries": 0,
		"timeout": 2880,
		"maxConcurrentRuns": 20,
		"security": "none",
		"scriptName": "ocse-da-main-clean-curated-job.py",
		"scriptLocation": "s3://aws-glue-assets-884666078658-us-east-1/scripts/",
		"language": "python-3",
		"spark": true,
		"sparkConfiguration": "standard",
		"jobParameters": [],
		"tags": [],
		"jobMode": "DEVELOPER_MODE",
		"createdOn": "2023-08-03T01:40:54.890Z",
		"developerMode": true,
		"connectionsList": [],
		"temporaryDirectory": "s3://aws-glue-assets-884666078658-us-east-1/temporary/",
		"logging": true,
		"glueHiveMetastore": true,
		"etlAutoTuning": false,
		"metrics": true,
		"bookmark": "job-bookmark-enable",
		"sparkPath": "s3://aws-glue-assets-884666078658-us-east-1/sparkHistoryLogs/",
		"flexExecution": false,
		"minFlexWorkers": null,
		"sourceControlDetails": {
			"Provider": "AWS_CODE_COMMIT",
			"Repository": "syt_da_cicd",
			"Branch": "main",
			"Folder": "ocse-da-main-clean-curated-job",
			"LastCommitId": "12a851f157b519232485ba69d5dfc0b5024caa59"
		}
	},
	"hasBeenSaved": false,
	"script": "import sys\r\nfrom awsglue.utils import getResolvedOptions\r\nfrom pyspark.context import SparkContext\r\nfrom awsglue.context import GlueContext\r\nfrom awsglue.job import Job\r\nfrom delta.tables import DeltaTable\r\nfrom pyspark.sql.functions import col\r\nfrom pyspark.sql.functions import expr\r\nimport logging\r\n\r\nLOGGER = logging.getLogger(__name__)\r\n\r\n\r\ndef mergeAllDeltaDf(spark, target_loc_path, src_inc_df, *join_keys):\r\n    print(\"Append incremental load into Delta table\")\r\n    if src_inc_df.count() < 1:\r\n        return  # no records in the dataframe\r\n    con_str = \"\"\r\n    for index, join_key in enumerate(join_keys):\r\n        jkey = \"( prev_df.\"+join_key+\"= append_df.\"+join_key+\" )\"\r\n        if index == len(join_keys)-1:\r\n            con_str = con_str + jkey\r\n        else:\r\n            con_str = con_str + jkey + \" and \"\r\n    print(con_str)\r\n    target_delta_df = DeltaTable.forPath(spark, target_loc_path)\r\n    # delta_df.toDF().show(5,True)\r\n    # target_delta_df.vacuum(1)\r\n    # target_delta_df.history().show()\r\n    # Joining the dataframes on primarykey\r\n    result_df = (target_delta_df.alias(\"prev_df\").merge(\r\n                 source=src_inc_df.alias(\"append_df\"),\r\n                 condition=expr(con_str))\r\n                 ).whenMatchedUpdateAll().whenNotMatchedInsertAll().execute()\r\n    return result_df\r\n\r\n\r\ndef removeDuplicatesRecords(df, pk):\r\n    cnt = df.dropDuplicates(pk).count()\r\n    colname = 'rec_ingested_dt'\r\n    if 'insrt_ts' in df.columns:\r\n        colname = 'insrt_ts'\r\n    elif 'dms_commit_ts' in df.columns:\r\n        colname = 'dms_commit_ts'\r\n    if (colname in df.columns and df.count() > cnt):\r\n        print(\"Incoming data has are dulicate records \")\r\n        recrds = df.orderBy(col(colname).desc_nulls_first())\r\n        df_distinct = recrds.dropDuplicates(pk)\r\n        # df_distinct.show()\r\n        print(colname, \" is used for dedupe, size:\", df_distinct.count())\r\n        return df_distinct\r\n    else:\r\n        print(\"no duplicates records found in the inc dataframe\")\r\n        return df\r\n\r\n\r\ndef main():\r\n    datasetParamDict = {\r\n\r\n        \"ofcr_person\": {\r\n            \"table_name\": \"ofcr_person\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\",\r\n                \"ssn\",\r\n                \"ssn_seq\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"prtcp_typ\",\r\n                \"st\"\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_person\"\r\n        },\r\n        \"ofcr_states\": {\r\n            \"table_name\": \"ofcr_states\",\r\n            \"primary_key_col\": [\r\n                \"st\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_states\"\r\n        },\r\n        \"ofcr_other\": {\r\n            \"table_name\": \"ofcr_other\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\",\r\n                \"ssn\",\r\n                \"ssn_seq\",\r\n                \"oth_seq_no\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\"\r\n            ],\r\n            \"pii_col\": {\r\n            },\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_other\",\r\n            \"date_trns_cols\": []\r\n        },\r\n        \"ofcr_fipscref\": {\r\n            \"table_name\": \"ofcr_fipscref\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"fips_cnty_cd\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\"\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_fipscref\",\r\n            \"date_trns_cols\": []\r\n        },\r\n        \"ofcr_fcrcase\": {\r\n            \"table_name\": \"ofcr_fcrcase\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\",\r\n                \"fips_cnty_cd\"\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_fcrcase\",\r\n            \"date_trns_cols\": []\r\n        },\r\n        \"ofcr_famvi\": {\r\n            \"table_name\": \"ofcr_famvi\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\",\r\n                \"ssn\",\r\n                \"ssn_seq\",\r\n                \"fv_dt_estb\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\"\r\n            ],\r\n            \"pii_col\": {\r\n            },\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_famvi\",\r\n            \"date_trns_cols\": []\r\n        },\r\n        \"ofcr_dthinfo\": {\r\n            \"table_name\": \"ofcr_dthinfo\",\r\n            \"primary_key_col\": [\r\n                \"ssn\"\r\n            ],\r\n            \"partition_cols\": [\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_dthinfo\",\r\n            \"date_trns_cols\": []\r\n        },\r\n        \"pcsenet_txnhdr\": {\r\n            \"table_name\": \"pcsenet_txnhdr\",\r\n            \"primary_key_col\": [\r\n                \"csenet_idfr\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"fn_cd\"\r\n            ],\r\n            \"s3_target_write_folder\": \"fpls/pcsenet_txnhdr\"\r\n        },\r\n        \"fplsrs_fcr_case\": {\r\n            \"table_name\": \"fplsrs_fcr_case\",\r\n            \"primary_key_col\": [\r\n                \"fcr_case_uid\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st_cd\",\r\n                \"case_typ_cd\"\r\n            ],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_fcr_case\",\r\n            \"date_trns_cols\": [],\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_fcr_prsn_in_case\": {\r\n            \"table_name\": \"fplsrs_fcr_prsn_in_case\",\r\n            \"primary_key_col\": [\r\n                \"FCR_PRSN_IN_CASE_UID\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st_cd\"\r\n            ],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_fcr_prsn_in_case\",\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_ndnh_qw\": {\r\n            \"table_name\": \"fplsrs_ndnh_qw\",\r\n            \"primary_key_col\": [\r\n                \"ndnh_qw_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_ndnh_qw\",\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_ndnh_ui_claim\": {\r\n            \"table_name\": \"fplsrs_ndnh_ui_claim\",\r\n            \"primary_key_col\": [\r\n                \"ndnh_ui_claim_uid\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"sbmtng_st_cd\"\r\n            ],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_ndnh_ui_claim\",\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_rs_calendar\": {\r\n            \"table_name\": \"fplsrs_rs_calendar\",\r\n            \"primary_key_col\": [\r\n                \"PRCSD_DT\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_rs_calendar\",\r\n            \"date_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_prfl_stus_ref\": {\r\n            \"table_name\": \"comm_comm_prfl_stus_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_prfl_stus_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_prfl_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_typ_msg\": {\r\n            \"table_name\": \"comm_comm_typ_msg\",\r\n            \"primary_key_col\": [\r\n                \"comm_typ_msg_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_typ_msg\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_typ_msg_typ_ref\": {\r\n            \"table_name\": \"comm_comm_typ_msg_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_typ_msg_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_typ_msg_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_typ_ref\": {\r\n            \"table_name\": \"comm_comm_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_user\": {\r\n            \"table_name\": \"comm_comm_user\",\r\n            \"primary_key_col\": [\r\n                \"comm_user_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_user\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_user_pref_xref\": {\r\n            \"table_name\": \"comm_comm_user_pref_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_user_pref_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_user_pref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_prtcpt\": {\r\n            \"table_name\": \"comm_prtcpt\",\r\n            \"primary_key_col\": [\r\n                \"prtcpt_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_prtcpt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_prtcpt_typ_ref\": {\r\n            \"table_name\": \"comm_prtcpt_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"prtcpt_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_prtcpt_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_state_ref\": {\r\n            \"table_name\": \"comm_state_ref\",\r\n            \"primary_key_col\": [\r\n                \"state_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_state_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt\": {\r\n            \"table_name\": \"audt\",\r\n            \"primary_key_col\": [\r\n                \"audt_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_affiln_comm_rtng_ref\": {\r\n            \"table_name\": \"comm_affiln_comm_rtng_ref\",\r\n            \"primary_key_col\": [\r\n                \"affiln_comm_rtng_ref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_affiln_comm_rtng_ref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_affiln_typ_ref\": {\r\n            \"table_name\": \"comm_affiln_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"affiln_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_affiln_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_centl_mailbox_pref\": {\r\n            \"table_name\": \"comm_centl_mailbox_pref\",\r\n            \"primary_key_col\": [\r\n                \"centl_mailbox_pref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_centl_mailbox_pref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm\": {\r\n            \"table_name\": \"comm_comm\",\r\n            \"primary_key_col\": [\r\n                \"comm_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_actn\": {\r\n            \"table_name\": \"comm_comm_actn\",\r\n            \"primary_key_col\": [\r\n                \"comm_actn_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_actn\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_actn_pref_xref\": {\r\n            \"table_name\": \"comm_comm_actn_pref_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_actn_pref_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_actn_pref_xref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_actn_typ_ref\": {\r\n            \"table_name\": \"comm_comm_actn_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_actn_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_actn_typ_ref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_affiln_typ_ref\": {\r\n            \"table_name\": \"comm_comm_affiln_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_affiln_typ_ref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_affiln_typ_ref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_app_actvn_ref\": {\r\n            \"table_name\": \"comm_comm_app_actvn_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_app_actvn_ref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_app_actvn_ref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n\r\n        \"comm_comm_app_prfl_stus\": {\r\n            \"table_name\": \"comm_comm_app_prfl_stus\",\r\n            \"primary_key_col\": [\r\n                \"comm_app_prfl_stus_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_app_prfl_stus\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_atcht\": {\r\n            \"table_name\": \"comm_comm_atcht\",\r\n            \"primary_key_col\": [\r\n                \"comm_atcht_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_atcht\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_atcht_ctnt_typ_ref\": {\r\n            \"table_name\": \"comm_comm_atcht_ctnt_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_atcht_ctnt_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_atcht_ctnt_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n\r\n        \"comm_comm_pref_comm_typ_msg_xref\": {\r\n            \"table_name\": \"comm_comm_pref_comm_typ_msg_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_pref_comm_typ_msg_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_pref_comm_typ_msg_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_pref_org_rlshp\": {\r\n            \"table_name\": \"comm_comm_pref_org_rlshp\",\r\n            \"primary_key_col\": [\r\n                \"comm_pref_org_rlshp_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_pref_org_rlshp\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_pref\": {\r\n            \"table_name\": \"comm_comm_pref\",\r\n            \"primary_key_col\": [\r\n                \"comm_pref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_pref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_centl_mailbox_pref_xref\": {\r\n            \"table_name\": \"comm_comm_centl_mailbox_pref_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_centl_mailbox_pref_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_centl_mailbox_pref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_btch_ntfn_comm\": {\r\n            \"table_name\": \"comm_comm_btch_ntfn_comm\",\r\n            \"primary_key_col\": [\"comm_btch_ntfn_comm_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_btch_ntfn_comm\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_btch_ntfn\": {\r\n            \"table_name\": \"comm_comm_btch_ntfn\",\r\n            \"primary_key_col\": [\r\n                \"comm_btch_ntfn_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_btch_ntfn\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_acct\": {\r\n            \"table_name\": \"prfl_acct\",\r\n            \"primary_key_col\": [\"acct_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_acct\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_acct_org_xref\": {\r\n            \"table_name\": \"prfl_acct_org_xref\",\r\n            \"primary_key_col\": [\"acct_org_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_acct_org_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_affiln_typ_ref\": {\r\n            \"table_name\": \"prfl_affiln_typ_ref\",\r\n            \"primary_key_col\": [\"affiln_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_affiln_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_cntct_typ_grp_cntct_typ_xref\": {\r\n            \"table_name\": \"prfl_cntct_typ_grp_cntct_typ_xref\",\r\n            \"primary_key_col\": [\"cntct_typ_grp_cntct_typ_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_cntct_typ_grp_cntct_typ_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_cntct_typ_grp_ref\": {\r\n            \"table_name\": \"prfl_cntct_typ_grp_ref\",\r\n            \"primary_key_col\": [\"affiln_typ_cd\", \"cntct_typ_grp_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_cntct_typ_grp_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_cntct_typ_ref\": {\r\n            \"table_name\": \"prfl_cntct_typ_ref\",\r\n            \"primary_key_col\": [\"affiln_typ_cd\", \"cntct_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_cntct_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_empr_info_stus\": {\r\n            \"table_name\": \"prfl_empr_info_stus\",\r\n            \"primary_key_col\": [\"empr_info_stus_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_empr_info_stus\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt\": {\r\n            \"table_name\": \"prfl_org_enrlt\",\r\n            \"primary_key_col\": [\"org_enrlt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt_stus_ref\": {\r\n            \"table_name\": \"prfl_org_enrlt_stus_ref\",\r\n            \"primary_key_col\": [\"org_enrlt_stus_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt_typ_ref\": {\r\n            \"table_name\": \"prfl_org_enrlt_typ_ref\",\r\n            \"primary_key_col\": [\"org_enrlt_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt_user\": {\r\n            \"table_name\": \"prfl_org_enrlt_user\",\r\n            \"primary_key_col\": [\"org_enrlt_user_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt_user\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prfl_pref\": {\r\n            \"table_name\": \"prfl_prfl_pref\",\r\n            \"primary_key_col\": [\"prfl_pref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prfl_pref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prfl_pref_qstn_ref\": {\r\n            \"table_name\": \"prfl_prfl_pref_qstn_ref\",\r\n            \"primary_key_col\": [\"prfl_pref_qstn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prfl_pref_qstn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prfl_stus_ref\": {\r\n            \"table_name\": \"prfl_prfl_stus_ref\",\r\n            \"primary_key_col\": [\"prfl_stus_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prfl_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn\": {\r\n            \"table_name\": \"prfl_prsn\",\r\n            \"primary_key_col\": [\"prsn_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_acct_xref\": {\r\n            \"table_name\": \"prfl_prsn_acct_xref\",\r\n            \"primary_key_col\": [\"prsn_acct_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_acct_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_org_cntct_typ_app_xref\": {\r\n            \"table_name\": \"prfl_prsn_org_cntct_typ_app_xref\",\r\n            \"primary_key_col\": [\"prsn_org_cntct_typ_app_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_org_cntct_typ_app_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_org_prsn_updt_audt\": {\r\n            \"table_name\": \"prfl_prsn_org_prsn_updt_audt\",\r\n            \"primary_key_col\": [\"prsn_org_prsn_updt_audt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_org_prsn_updt_audt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_org_xref\": {\r\n            \"table_name\": \"prfl_prsn_org_xref\",\r\n            \"primary_key_col\": [\"prsn_org_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_org_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_resp_formt_ref\": {\r\n            \"table_name\": \"prfl_resp_formt_ref\",\r\n            \"primary_key_col\": [\"resp_formt_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_resp_formt_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_st_user_id_rlshp\": {\r\n            \"table_name\": \"prfl_st_user_id_rlshp\",\r\n            \"primary_key_col\": [\"st_user_id_rlshp_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_st_user_id_rlshp\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_actn_ref\": {\r\n            \"table_name\": \"audt_actn_ref\",\r\n            \"primary_key_col\": [\"actn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_actn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_application_typ_ref\": {\r\n            \"table_name\": \"audt_application_typ_ref\",\r\n            \"primary_key_col\": [\"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_application_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_audt\": {\r\n            \"table_name\": \"audt_audt\",\r\n            \"primary_key_col\": [\"audt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_audt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_btch_oper_typ_ref\": {\r\n            \"table_name\": \"audt_btch_oper_typ_ref\",\r\n            \"primary_key_col\": [\"btch_oper_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_btch_oper_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_page_typ_ref\": {\r\n            \"table_name\": \"audt_page_typ_ref\",\r\n            \"primary_key_col\": [\"page_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_page_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_prc_ref\": {\r\n            \"table_name\": \"audt_prc_ref\",\r\n            \"primary_key_col\": [\"prc_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_prc_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_state_ref\": {\r\n            \"table_name\": \"audt_state_ref\",\r\n            \"primary_key_col\": [\"state_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_state_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_tracking\": {\r\n            \"table_name\": \"audt_tracking\",\r\n            \"primary_key_col\": [\"tracking_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_tracking\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_account_locations\": {\r\n            \"table_name\": \"ptl_account_locations\",\r\n            \"primary_key_col\": [\"org_prfl_uid\", \"state_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_account_locations\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_account_status_ref\": {\r\n            \"table_name\": \"ptl_account_status_ref\",\r\n            \"primary_key_col\": [\"account_status_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_account_status_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_action_typ_ref\": {\r\n            \"table_name\": \"ptl_action_typ_ref\",\r\n            \"primary_key_col\": [\"action_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_action_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_addr_typ_ref\": {\r\n            \"table_name\": \"ptl_addr_typ_ref\",\r\n            \"primary_key_col\": [\"addr_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_addr_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_alternative_org_address\": {\r\n            \"table_name\": \"ptl_alternative_org_address\",\r\n            \"primary_key_col\": [\"alt_addr_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_alternative_org_address\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_alternative_org_address_typ\": {\r\n            \"table_name\": \"ptl_alternative_org_address_typ\",\r\n            \"primary_key_col\": [\"addr_typ_cd\", \"alt_addr_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_alternative_org_address_typ\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_app_clsfn_ref\": {\r\n            \"table_name\": \"ptl_app_clsfn_ref\",\r\n            \"primary_key_col\": [\"app_clsfn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_app_clsfn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_contact\": {\r\n            \"table_name\": \"ptl_contact\",\r\n            \"primary_key_col\": [\"contact_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_contact\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_contact_typ_ref\": {\r\n            \"table_name\": \"ptl_contact_typ_ref\",\r\n            \"primary_key_col\": [\"contact_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_contact_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_country_ref\": {\r\n            \"table_name\": \"ptl_country_ref\",\r\n            \"primary_key_col\": [\"country_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_country_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_empr_certn_elgt_stus_ref\": {\r\n            \"table_name\": \"ptl_empr_certn_elgt_stus_ref\",\r\n            \"primary_key_col\": [\"empr_certn_elgt_stus_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_empr_certn_elgt_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_prfl\": {\r\n            \"table_name\": \"ptl_org_prfl\",\r\n            \"primary_key_col\": [\"org_prfl_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_prfl\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_prfl_addr_typ\": {\r\n            \"table_name\": \"ptl_org_prfl_addr_typ\",\r\n            \"primary_key_col\": [\"org_prfl_uid\", \"addr_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_prfl_addr_typ\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_prfl_vrfn_cd_ref\": {\r\n            \"table_name\": \"ptl_org_prfl_vrfn_cd_ref\",\r\n            \"primary_key_col\": [\"prfl_vrfn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \r\n                \"ptl/ptl_org_prfl_vrfn_cd_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_relationship\": {\r\n            \"table_name\": \"ptl_org_relationship\",\r\n            \"primary_key_col\": [\r\n                \"child_org_prfl_uid\",\r\n                \"parent_org_prfl_uid\", \r\n                \"org_relationship_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \r\n                \"ptl/ptl_org_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_relationship_typ_ref\": {\r\n            \"table_name\": \"ptl_org_relationship_typ_ref\",\r\n            \"primary_key_col\": [\"org_relationship_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_relationship_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_resplt\": {\r\n            \"table_name\": \"ptl_org_resplt\",\r\n            \"primary_key_col\": [\"org_resplt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_resplt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_resplt_ref\": {\r\n            \"table_name\": \"ptl_org_resplt_ref\",\r\n            \"primary_key_col\": [\"org_resplt_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_resplt_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_role_app_relationship\": {\r\n            \"table_name\": \"ptl_org_role_app_relationship\",\r\n            \"primary_key_col\": [\"application_typ_cd\", \"org_role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_role_typ_ref\": {\r\n            \"table_name\": \"ptl_org_role_typ_ref\",\r\n            \"primary_key_col\": [\"org_role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_role_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_typ_ref_org_resplt_ref_xref\": {\r\n            \"table_name\": \"ptl_org_typ_ref_org_resplt_ref_xref\",\r\n            \"primary_key_col\": [\"org_typ_ref_org_resplt_ref_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\":\r\n                \"ptl/ptl_org_typ_ref_org_resplt_ref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_typ_ref_org_role_typ_ref_xref\": {\r\n            \"table_name\": \"ptl_org_typ_ref_org_role_typ_ref_xref\",\r\n            \"primary_key_col\": [\"org_typ_ref_org_role_typ_ref_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \r\n                \"ptl/ptl_org_typ_ref_org_role_typ_ref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_page_typ_ref\": {\r\n            \"table_name\": \"ptl_page_typ_ref\",\r\n            \"primary_key_col\": [\"page_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_page_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_prfl_role_app_relationship\": {\r\n            \"table_name\": \"ptl_prfl_role_app_relationship\",\r\n            \"primary_key_col\": [\r\n                \"org_role_typ_cd\",\r\n                \"role_typ_cd\",\r\n                \"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_prfl_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_role_app_relationship\": {\r\n            \"table_name\": \"ptl_role_app_relationship\",\r\n            \"primary_key_col\": [\"role_typ_cd\", \"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_role_page_relationship\": {\r\n            \"table_name\": \"ptl_role_page_relationship\",\r\n            \"primary_key_col\": [\"role_typ_cd\", \"page_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_role_page_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_role_typ_ref\": {\r\n            \"table_name\": \"ptl_role_typ_ref\",\r\n            \"primary_key_col\": [\"role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_role_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_state_county_ref\": {\r\n            \"table_name\": \"ptl_state_county_ref\",\r\n            \"primary_key_col\": [\"state_cd\", \"county_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_state_county_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_state_role_app_relationship\": {\r\n            \"table_name\": \"ptl_state_role_app_relationship\",\r\n            \"primary_key_col\": [\r\n                \"state_cd\",\r\n                \"role_typ_cd\",\r\n                \"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_state_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_account\": {\r\n            \"table_name\": \"ptl_user_account\",\r\n            \"primary_key_col\": [\"user_account_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_account\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_affiln_ref\": {\r\n            \"table_name\": \"ptl_user_affiln_ref\",\r\n            \"primary_key_col\": [\"user_affiln_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_affiln_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_affiln_subfn_ref\": {\r\n            \"table_name\": \"ptl_user_affiln_subfn_ref\",\r\n            \"primary_key_col\": [\"user_affiln_subfn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_affiln_subfn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_afiln_subfn_role_typ_xref\": {\r\n            \"table_name\": \"ptl_user_afiln_subfn_role_typ_xref\",\r\n            \"primary_key_col\": [\"user_affiln_subfn_cd\", \"role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_afiln_subfn_role_typ_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_org_relationship\": {\r\n            \"table_name\": \"ptl_user_org_relationship\",\r\n            \"primary_key_col\": [\"org_prfl_uid\", \"user_account_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_org_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_role_app_relationship\": {\r\n            \"table_name\": \"ptl_user_role_app_relationship\",\r\n            \"primary_key_col\": [\r\n                \"role_typ_cd\",\r\n                \"application_typ_cd\",\r\n                \"user_account_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        }\r\n    }\r\n    # Get Job arguments to be passed to process the raw data\r\n    args = (getResolvedOptions(sys.argv,\r\n            [\"JOB_NAME\", \"envname\", 'dataset_name', 'source_db']))\r\n    env_name = args['envname']  # Environment Name\r\n    dataset_nm = args['dataset_name']  # Dataset name to be processed\r\n    source_db = args['source_db']  # Source database name\r\n    print('source_db : {0} , dataset_nm:{1} ,  env_name:{2} '\r\n          .format(source_db, dataset_nm, env_name))\r\n\r\n    sc = SparkContext()\r\n    glueContext = GlueContext(sc)\r\n    spark = glueContext.spark_session\r\n    job = Job(glueContext)\r\n    job.init(args[\"JOB_NAME\"]+'_'+dataset_nm, args)\r\n\r\n    dataset_dict_obj = datasetParamDict.get(dataset_nm)\r\n    print(dataset_dict_obj)\r\n    # Target folder name to write the delta files\r\n    target_folder = dataset_dict_obj.get(\"s3_target_write_folder\")\r\n    target_s3path = \"s3://ocse-\"+env_name+\"-da-main-curated-data/glue-db/\"\r\n    # Complete path to write the delta files\r\n    fld_path = target_s3path+target_folder+\"/\"\r\n    print(\"fld_path:\", fld_path)\r\n    partition_cols_list = dataset_dict_obj.get(\"partition_cols\")\r\n    print(\"partition_cols_list\", partition_cols_list)\r\n\r\n    print(\"table name :\", dataset_dict_obj.get(\"table_name\"))\r\n\r\n    dataset_ddf = glueContext.create_dynamic_frame.from_catalog(\r\n        database=source_db,\r\n        table_name=dataset_dict_obj.get(\"table_name\"),\r\n        # transformation_ctx=\"dataset_ddf\"\r\n        transformation_ctx=dataset_dict_obj.get(\"table_name\")+\"_dff\"\r\n    )\r\n\r\n    # 6.Get primary key and write delta files\r\n    pk_key_list = (dataset_dict_obj.get(\"primary_key_col\"))\r\n    print(\"pk_key_list:\", pk_key_list)\r\n\r\n    inc_df = dataset_ddf.toDF()\r\n    # inc_df.show(2)\r\n    print(\"inc_df count\", inc_df.count())\r\n\r\n    if inc_df.count() > 0:\r\n        inc_df = removeDuplicatesRecords(inc_df, pk_key_list)\r\n    else:\r\n        print(\"dataset is empty. so no duplicates found.\")\r\n\r\n    if (DeltaTable.isDeltaTable(spark, fld_path)):\r\n        print(\"inside the main if for files\")\r\n        mergeAllDeltaDf(spark, fld_path, inc_df, *pk_key_list)\r\n    else:\r\n        # First time delta file write\r\n        print(\"First time delta file writing...\")\r\n        additional_options = {\r\n            \"path\": fld_path,\r\n            \"write.parquet.compression-codec\": \"snappy\",\r\n        }\r\n        if inc_df.count() > 0 and len(partition_cols_list) < 1:\r\n            print(\"Partition columns are not present\")\r\n            (inc_df.write.format(\"delta\")\r\n                         .options(**additional_options)\r\n                         .mode(\"append\")\r\n                         .save())\r\n        elif inc_df.count() > 0:\r\n            print(\"partition cols list:\", partition_cols_list)\r\n            (inc_df.write.format(\"delta\")\r\n                         .options(**additional_options)\r\n                         .mode(\"append\")\r\n                         .partitionBy(*partition_cols_list)\r\n                         .save())\r\n\r\n    job.commit()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    try:\r\n        main()\r\n    except Exception as e:\r\n        LOGGER.error(\"An unexpected error in main() occurred.\", exc_info=e)\r\n        sys.exit(1)"
}