{
	"jobConfig": {
		"name": "ocse-deid-main-raw-clean-job",
		"description": "",
		"role": "arn:aws:iam::884666078658:role/OcseDeidMainGlueServiceRole",
		"command": "glueetl",
		"version": "4.0",
		"runtime": null,
		"workerType": "G.1X",
		"numberOfWorkers": 20,
		"maxCapacity": 20,
		"maxRetries": 0,
		"timeout": 2880,
		"maxConcurrentRuns": 20,
		"security": "none",
		"scriptName": "ocse-deid-main-raw-clean-job.py",
		"scriptLocation": "s3://aws-glue-assets-884666078658-us-east-1/scripts/",
		"language": "python-3",
		"spark": false,
		"sparkConfiguration": "standard",
		"jobParameters": [
			{
				"key": "--datalake-formats",
				"value": "delta",
				"existing": false
			}
		],
		"tags": [],
		"jobMode": "DEVELOPER_MODE",
		"createdOn": "2024-03-31T21:28:57.618Z",
		"developerMode": true,
		"connectionsList": [],
		"temporaryDirectory": "s3://aws-glue-assets-884666078658-us-east-1/temporary/",
		"logging": true,
		"glueHiveMetastore": true,
		"etlAutoTuning": false,
		"metrics": true,
		"pythonPath": "s3://aws-glue-assets-884666078658-us-east-1/scripts/ocss_dataframe.py",
		"bookmark": "job-bookmark-enable",
		"sparkPath": "s3://aws-glue-assets-884666078658-us-east-1/sparkHistoryLogs/",
		"flexExecution": false,
		"minFlexWorkers": null,
		"sourceControlDetails": {
			"Provider": "AWS_CODE_COMMIT",
			"Repository": "syt_da_cicd",
			"Branch": "main",
			"Folder": "ocse-deid-main-raw-clean-job",
			"LastCommitId": "0c02247f728ee210a22ea9ca9b19edd513f4a22d"
		}
	},
	"hasBeenSaved": false,
	"script": "import hashlib\r\nimport logging\r\nimport sys\r\nimport uuid\r\nfrom awsglue.context import GlueContext\r\nfrom awsglue.dynamicframe import DynamicFrame\r\nfrom awsglue.job import Job\r\nfrom awsglue.utils import getResolvedOptions\r\nimport boto3\r\nimport botocore\r\nfrom pyspark.context import SparkContext\r\nfrom pyspark.sql.functions import to_date, to_timestamp, col, lit, udf\r\nfrom pyspark.sql.functions import expr, current_timestamp\r\nfrom pyspark.sql.functions import regexp_replace, concat, format_string\r\nfrom pyspark.sql.types import StringType\r\n\r\n\r\nLOGGER = logging.getLogger(__name__)\r\n\r\n'''\r\nAshok Pavuluri, 6/3/2023\r\nThis module contains all reusable Dataframe methods\r\n'''\r\n\r\nlist_translation_type = ['case_id', 'ssn', 'fein', 'email', 'person_nm',\r\n                         'user_cd', 'phone_num']\r\n\r\nclient = boto3.client(\"dynamodb\")\r\npii_local_dict = {}\r\n\r\n\r\n# Adding audit details to the dataframe\r\ndef addAuditInfo(df):\r\n    return df.withColumn(\"rec_ingested_dt\", current_timestamp())\r\n\r\n\r\n# Get Item from Dynamo DB table\r\ndef getItemFromLookupTable(tbl_name, partition_key, sort_key,\r\n                           part_key_val, sort_key_val):\r\n    client = boto3.client(\"dynamodb\")\r\n    response = client.get_item(Key={partition_key: {\r\n        'S': str(part_key_val),\r\n    },\r\n        sort_key: {\r\n        'S': sort_key_val,\r\n    }\r\n    },\r\n        TableName=tbl_name,\r\n    )\r\n    client.close()\r\n    if (response.get('Item')):\r\n        hashed_val = response.get('Item')['hashed_value']['S']\r\n        print(\"hashed_val:\", hashed_val)\r\n        pii_local_dict[str(part_key_val)] = hashed_val\r\n        return hashed_val\r\n    else:\r\n        return ''\r\n\r\n\r\ndef getHashText(pii_value):\r\n    \"\"\"\r\n        Basic hashing function for a pii_value using random unique salt.\r\n    \"\"\"\r\n    salt = uuid.uuid4().hex\r\n    return hashlib.sha256(salt.encode() + str(pii_value).encode()).hexdigest()\r\n\r\n\r\n'''\r\n1.SSN -> SHA-256 HASH with Random Salt\r\n2.FEIN/EIN -> SHA-256 HASH with Random Salt\r\n3.Case ID -> SHA-256 HASH with Random Salt\r\n4.Date of -> Birth Maintain as the decade of birth\r\n=>Exclude fields like 5.First Name, 6.Last Name, 7.Street Address,\r\n8.Email Address, 9.Phone\r\nAdd New column name by appending _hash to the source column, then apply hashing\r\n'''\r\n\r\n\r\ndef getFromDict(pii_value):\r\n    return pii_local_dict.get(pii_value)\r\n\r\n\r\n# Generate new Hashcode or retrived existing one from Dynamo DB lookup tbl\r\ndef getOrGenerateHash(col_nm_to_be_hashed, translation_type,\r\n                      pii_value, pii_lkup_table):\r\n    if (pii_value is None or len(pii_value) == 0):\r\n        return \"\"\r\n    if (getFromDict(pii_value)):\r\n        pre_hashed_code = getFromDict(pii_value)\r\n        print(\"local read\")\r\n    else:\r\n        pre_hashed_code = getItemFromLookupTable(pii_lkup_table, 'pii_value',\r\n                                                 'pii_type', pii_value,\r\n                                                 translation_type)\r\n\r\n    print(\"pre_hashed_code\", pre_hashed_code)\r\n    if (pre_hashed_code):  # If case_id already hashed, return older hash code\r\n        return pre_hashed_code\r\n    else:  # Generate new hascode after salting\r\n        new_hash_value = getHashText(pii_value)\r\n        print(\"new hashvalue is generated:\", new_hash_value)\r\n        dic = {'pii_value': pii_value, 'hashed_value': new_hash_value,\r\n               'pii_type': translation_type}\r\n\r\n        if dynamoTransactWrite([createDyPutElement(createItems(dic),\r\n                                                   'pii_value',\r\n                                                   pii_lkup_table)]):\r\n            # If TransactionCanceledException conflict occured,\r\n            # then look for new hashed value or generate one again,\r\n            # and update Dynamo table\r\n            pre_hashed_code = (getItemFromLookupTable(\r\n                               pii_lkup_table, 'pii_value', 'pii_type',\r\n                               pii_value, translation_type)\r\n                               )\r\n            if (pre_hashed_code):\r\n                return pre_hashed_code\r\n            else:\r\n                new_hash_value = getHashText(pii_value)\r\n                dic = {'pii_value': pii_value,\r\n                       'hashed_value': new_hash_value,\r\n                       'pii_type': translation_type}\r\n\r\n                dynamoTransactWrite(\r\n                    [createDyPutElement(createItems(dic),\r\n                                        'pii_value',\r\n                                        pii_lkup_table)]\r\n                )\r\n        return new_hash_value\r\n\r\n\r\n# Masking the date ex: 12/12/31 --> 12/12/01 Year and Month remains\r\n# same but day is changed to 01\r\ndef getMaskedDate(df, col_nm):\r\n    return (df.withColumn(\r\n        col_nm,\r\n        concat(expr(\"year(\"+col_nm+\")\"),\r\n               format_string(\"-%02d\",\r\n                             expr(\"month(\"+col_nm+\")\")),\r\n               lit(\"-01\"))\r\n    ).withColumn(col_nm, to_date(col(col_nm),\r\n                                 \"yyyy-MM-dd\"))\r\n\r\n    )\r\n\r\n\r\ndef dynamoTransactWrite(items_list):\r\n    print(\"start dynamoTransactWrite\")\r\n    print(items_list)\r\n    explist = []\r\n    try:\r\n        client = boto3.client(\"dynamodb\")\r\n        client.transact_write_items(TransactItems=items_list)\r\n        client.close()\r\n        return False\r\n    # Handle few error codes of TransactionCanceledException\r\n    except client.exceptions.TransactionCanceledException as e1:\r\n        print(e1.response['Error']['Code'])\r\n        return True\r\n    except botocore.exceptions.ClientError as e:\r\n        print(e.response['Error']['Code'])\r\n        explist.append('ConditionalCheckFailedException')\r\n        explist.append('TransactionConflictException')\r\n        if e.response['Error']['Code'] not in explist:\r\n            #  return True\r\n            raise e\r\n\r\n\r\n# Create Dynamo DB single Item or Record\r\ndef createItems(pii_dict):\r\n    temp = {}\r\n    for rec in pii_dict:\r\n        temp.update({rec: {'S': str(pii_dict[rec])}})\r\n    return temp\r\n\r\n\r\n# Bundle items under Put element.\r\ndef createDyPutElement(item, con_exp_col_nm, tbl_nm):\r\n    return {\r\n        \"Put\": {\r\n            \"Item\": item,\r\n            'ConditionExpression': 'attribute_not_exists('+con_exp_col_nm+')',\r\n            \"TableName\": tbl_nm\r\n        }\r\n    }\r\n\r\n\r\n'''\r\nCode for Glue job starts here.\r\n'''\r\n\r\n\r\n# Function to process the PII Columns, Translation Types [DOB, SSN, CASE_ID]\r\ndef processPIIData(pii_dict_mapping, df_inc_raw):\r\n    print(\"inside processPIIData\")\r\n    if ((not pii_dict_mapping) or (not df_inc_raw.count())):\r\n        return df_inc_raw\r\n    # Register Hashing Funtion\r\n    piiColumnHashUdf = udf(getOrGenerateHash, StringType())\r\n    # Iterate over column name and tranlation type.\r\n    for pii_column_nm, pii_col_type in pii_dict_mapping.items():\r\n        if pii_col_type in list_translation_type:\r\n            df_inc_raw = df_inc_raw.withColumn(pii_column_nm,\r\n                                               piiColumnHashUdf(\r\n                                                   pii_column_nm,\r\n                                                   lit(pii_col_type),\r\n                                                   col(pii_column_nm),\r\n                                                   lit(pii_lkup_table)\r\n                                               ))\r\n        elif pii_col_type == 'dob':\r\n            df_inc_raw = getMaskedDate(df_inc_raw, pii_column_nm)\r\n    print(\"completed processPIIData\")\r\n    return df_inc_raw\r\n\r\n\r\n# Rename Columns\r\ndef renameColsOfDF(rename_cols_dict, df):\r\n    print(\"inside renameColsOfDF\")\r\n    if ((not rename_cols_dict) or (not df.count())):\r\n        return df\r\n    for col_old_nm, col_new_nm in rename_cols_dict.items():\r\n        df = df.withColumnRenamed(col_old_nm, col_new_nm)\r\n    return df\r\n\r\n\r\n# Drop the columns as per PII guidelines\r\ndef excludeColsFromDF(exclude_cols, df):\r\n    print(\"inside excludeColsFromDF\")\r\n    if (not exclude_cols or (not df.count())):\r\n        return df\r\n    return df.drop(*exclude_cols)\r\n\r\n\r\ndef coltransform(fmt, dataset_df, colnm):\r\n    dataset_df = dataset_df.withColumn(colnm,\r\n                                       regexp_replace(col(colnm), fmt, '')\r\n                                       )\r\n    return dataset_df\r\n\r\n\r\ndef main():\r\n    '''\r\n    This dictionary contains - all input dataset properties like\r\n    colNames,PKeys,PIICol etc\r\n    '''\r\n    datasetParamDict = {\r\n\r\n        \"ofcr_fipscref\": {\r\n            \"table_name\": \"ofcr_fipscref\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"fips_cnty_cd\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\"\r\n            ],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_fipscref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ofcr_fcrcase\": {\r\n            \"table_name\": \"ofcr_fcrcase\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\",\r\n                \"fips_cnty_cd\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"user_cd\": \"user_cd\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_fcrcase\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ofcr_famvi\": {\r\n            \"table_name\": \"ofcr_famvi\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\",\r\n                \"ssn\",\r\n                \"ssn_seq\",\r\n                \"fv_dt_estb\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"ssn\": \"ssn\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_famvi\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ofcr_dthinfo\": {\r\n            \"table_name\": \"ofcr_dthinfo\",\r\n            \"primary_key_col\": [\r\n                \"ssn\"\r\n            ],\r\n            \"partition_cols\": [\r\n\r\n            ],\r\n            \"pii_col\": {\r\n                \"ssn\": \"ssn\",\r\n                \"dob\": \"dob\",\r\n                \"dod\": \"dob\",\r\n                \"fnm\": \"person_nm\",\r\n                \"mnm\": \"person_nm\",\r\n                \"lnm\": \"person_nm\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_dthinfo\",\r\n            \"date_trns_cols\": {\r\n                \"stus_dt\": \"yyyy-MM-dd\"\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n\r\n        \"ofcr_person\": {\r\n            \"table_name\": \"ofcr_person\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\",\r\n                \"ssn\",\r\n                \"ssn_seq\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"prtcp_typ\",\r\n                \"st\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"ssn\": \"ssn\",\r\n                \"dob\": \"dob\",\r\n                \"dod\": \"dob\",\r\n                \"fnm16\": \"person_nm\",\r\n                \"mnm16\": \"person_nm\",\r\n                \"lnm30\": \"person_nm\"\r\n            },\r\n            \"exclude_cols\": [\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_person\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ofcr_states\": {\r\n            \"table_name\": \"ofcr_states\",\r\n            \"primary_key_col\": [\r\n                \"st\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_states\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ofcr_other\": {\r\n            \"table_name\": \"ofcr_other\",\r\n            \"primary_key_col\": [\r\n                \"st\",\r\n                \"st_case_id\",\r\n                \"ssn\",\r\n                \"ssn_seq\",\r\n                \"oth_seq_no\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"ssn\": \"ssn\",\r\n                \"oth_ssn\": \"ssn\",\r\n                \"oth_fnm16\": \"person_nm\",\r\n                \"oth_mnm16\": \"person_nm\",\r\n                \"oth_lnm30\": \"person_nm\"\r\n            },\r\n            \"exclude_cols\": [\r\n            ],\r\n            \"s3_target_write_folder\": \"ofcr/ofcr_other\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"pcsenet_txnhdr\": {\r\n            \"table_name\": \"pcsenet_txnhdr\",\r\n            \"primary_key_col\": [\r\n                \"csenet_idfr\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"fn_cd\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"case_idfr\": \"case_id\",\r\n                \"oth_case_idfr\": \"case_id\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"fpls/pcsenet_txnhdr\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_fcr_case\": {\r\n            \"table_name\": \"fplsrs_fcr_case\",\r\n            \"primary_key_col\": [\r\n                \"fcr_case_uid\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st_cd\",\r\n                \"case_typ_cd\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"di_case_id\": \"case_id\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_fcr_case\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_fcr_prsn_in_case\": {\r\n            \"table_name\": \"fplsrs_fcr_prsn_in_case\",\r\n            \"primary_key_col\": [\r\n                \"fcr_prsn_in_case_uid\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"st_cd\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"di_case_id\": \"case_id\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_fcr_prsn_in_case\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_ndnh_qw\": {\r\n            \"table_name\": \"fplsrs_ndnh_qw\",\r\n            \"primary_key_col\": [\r\n                \"ndnh_qw_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n                \"di_ssn\": \"ssn\", \"di_fein\": \"fein\"\r\n            },\r\n            \"exclude_cols\": [\r\n                \"src_optnl_addr_id\", \"src_prmry_addr_id\"\r\n            ],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_ndnh_qw\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_ndnh_ui_claim\": {\r\n            \"table_name\": \"fplsrs_ndnh_ui_claim\",\r\n            \"primary_key_col\": [\r\n                \"ndnh_ui_claim_uid\"\r\n            ],\r\n            \"partition_cols\": [\r\n                \"sbmtng_st_cd\"\r\n            ],\r\n            \"pii_col\": {\r\n                \"di_ssn\": \"ssn\"\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_ndnh_ui_claim\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"fplsrs_rs_calendar\": {\r\n            \"table_name\": \"fplsrs_rs_calendar\",\r\n            \"primary_key_col\": [\r\n                \"PRCSD_DT\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"micrs/fplsrs_rs_calendar\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_prfl_stus_ref\": {\r\n            \"table_name\": \"comm_comm_prfl_stus_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_prfl_stus_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_prfl_stus_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_typ_msg\": {\r\n            \"table_name\": \"comm_comm_typ_msg\",\r\n            \"primary_key_col\": [\r\n                \"comm_typ_msg_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_typ_msg\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_typ_msg_typ_ref\": {\r\n            \"table_name\": \"comm_comm_typ_msg_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_typ_msg_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_typ_msg_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_typ_ref\": {\r\n            \"table_name\": \"comm_comm_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_user\": {\r\n            \"table_name\": \"comm_comm_user\",\r\n            \"primary_key_col\": [\r\n                \"comm_user_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n                \"emailaddr_txt\": \"email\"\r\n            },\r\n            \"exclude_cols\": [\r\n                \"last_nm_txt\",\r\n                \"frst_nm_txt\"\r\n            ],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_user\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_user_pref_xref\": {\r\n            \"table_name\": \"comm_comm_user_pref_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_user_pref_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_user_pref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_prtcpt\": {\r\n            \"table_name\": \"comm_prtcpt\",\r\n            \"primary_key_col\": [\r\n                \"prtcpt_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n                \"emailaddr_txt\": \"email\"\r\n            },\r\n            \"exclude_cols\": [\r\n                \"frst_nm_txt\",\r\n                \"last_nm_txt\"\r\n            ],\r\n            \"s3_target_write_folder\": \"comm/comm_prtcpt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_prtcpt_typ_ref\": {\r\n            \"table_name\": \"comm_prtcpt_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"prtcpt_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_prtcpt_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_state_ref\": {\r\n            \"table_name\": \"comm_state_ref\",\r\n            \"primary_key_col\": [\r\n                \"state_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_state_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt\": {\r\n            \"table_name\": \"audt\",\r\n            \"primary_key_col\": [\r\n                \"audt_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_affiln_comm_rtng_ref\": {\r\n            \"table_name\": \"comm_affiln_comm_rtng_ref\",\r\n            \"primary_key_col\": [\r\n                \"affiln_comm_rtng_ref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_affiln_comm_rtng_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_affiln_typ_ref\": {\r\n            \"table_name\": \"comm_affiln_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"affiln_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_affiln_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_centl_mailbox_pref\": {\r\n            \"table_name\": \"comm_centl_mailbox_pref\",\r\n            \"primary_key_col\": [\r\n                \"centl_mailbox_pref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\"emailaddr_txt\": \"email\"},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_centl_mailbox_pref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm\": {\r\n            \"table_name\": \"comm_comm\",\r\n            \"primary_key_col\": [\r\n                \"comm_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\"ssn\": \"ssn\"},\r\n            \"exclude_cols\": [\"subj\"],\r\n            \"s3_target_write_folder\": \"comm/comm_comm\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"char_rep_trns\": {\"ssn\": [\" \", \"-\"]},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_actn\": {\r\n            \"table_name\": \"comm_comm_actn\",\r\n            \"primary_key_col\": [\r\n                \"comm_actn_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [\"msg\"],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_actn\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_actn_pref_xref\": {\r\n            \"table_name\": \"comm_comm_actn_pref_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_actn_pref_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_actn_pref_xref\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_actn_typ_ref\": {\r\n            \"table_name\": \"comm_comm_actn_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_actn_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_actn_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_affiln_typ_ref\": {\r\n            \"table_name\": \"comm_comm_affiln_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_affiln_typ_ref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_affiln_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_app_actvn_ref\": {\r\n            \"table_name\": \"comm_comm_app_actvn_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_app_actvn_ref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n            },\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_app_actvn_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_app_prfl_stus\": {\r\n            \"table_name\": \"comm_comm_app_prfl_stus\",\r\n            \"primary_key_col\": [\r\n                \"comm_app_prfl_stus_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_app_prfl_stus\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_atcht\": {\r\n            \"table_name\": \"comm_comm_atcht\",\r\n            \"primary_key_col\": [\r\n                \"comm_atcht_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\"atcht_nm\"],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_atcht\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_atcht_ctnt_typ_ref\": {\r\n            \"table_name\": \"comm_comm_atcht_ctnt_typ_ref\",\r\n            \"primary_key_col\": [\r\n                \"comm_atcht_ctnt_typ_cd\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_atcht_ctnt_typ_ref\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_btch_ntfn\": {\r\n            \"table_name\": \"comm_comm_btch_ntfn\",\r\n            \"primary_key_col\": [\r\n                \"comm_btch_ntfn_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\"rcver_emailaddr_text\": \"email\"},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_btch_ntfn\",\r\n            \"date_trns_cols\": {\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n\r\n        \"comm_comm_centl_mailbox_pref_xref\": {\r\n            \"table_name\": \"comm_comm_centl_mailbox_pref_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_centl_mailbox_pref_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_centl_mailbox_pref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_pref\": {\r\n            \"table_name\": \"comm_comm_pref\",\r\n            \"primary_key_col\": [\r\n                \"comm_pref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_pref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_pref_comm_typ_msg_xref\": {\r\n            \"table_name\": \"comm_comm_pref_comm_typ_msg_xref\",\r\n            \"primary_key_col\": [\r\n                \"comm_pref_comm_typ_msg_xref_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_pref_comm_typ_msg_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n\r\n        \"comm_comm_pref_org_rlshp\": {\r\n            \"table_name\": \"comm_comm_pref_org_rlshp\",\r\n            \"primary_key_col\": [\r\n                \"comm_pref_org_rlshp_uid\"\r\n            ],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_pref_org_rlshp\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"comm_comm_btch_ntfn_comm\": {\r\n            \"table_name\": \"comm_comm_btch_ntfn_comm\",\r\n            \"primary_key_col\": [\"comm_btch_ntfn_comm_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\"sendr_frst_nm_txt\", \"sendr_last_nm_txt\"],\r\n            \"s3_target_write_folder\": \"comm/comm_comm_btch_ntfn_comm\",\r\n            \"date_trns_cols\": {\r\n\r\n            },\r\n            \"ts_trns_cols\": {\r\n            },\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_acct\": {\r\n            \"table_name\": \"prfl_acct\",\r\n            \"primary_key_col\": [\"acct_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_acct\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_acct_org_xref\": {\r\n            \"table_name\": \"prfl_acct_org_xref\",\r\n            \"primary_key_col\": [\"acct_org_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_acct_org_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_affiln_typ_ref\": {\r\n            \"table_name\": \"prfl_affiln_typ_ref\",\r\n            \"primary_key_col\": [\"affiln_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_affiln_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_cntct_typ_grp_cntct_typ_xref\": {\r\n            \"table_name\": \"prfl_cntct_typ_grp_cntct_typ_xref\",\r\n            \"primary_key_col\": [\"cntct_typ_grp_cntct_typ_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_cntct_typ_grp_cntct_typ_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_cntct_typ_grp_ref\": {\r\n            \"table_name\": \"prfl_cntct_typ_grp_ref\",\r\n            \"primary_key_col\": [\"affiln_typ_cd\", \"cntct_typ_grp_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_cntct_typ_grp_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_cntct_typ_ref\": {\r\n            \"table_name\": \"prfl_cntct_typ_ref\",\r\n            \"primary_key_col\": [\"affiln_typ_cd\", \"cntct_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_cntct_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_empr_info_stus\": {\r\n            \"table_name\": \"prfl_empr_info_stus\",\r\n            \"primary_key_col\": [\"empr_info_stus_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_empr_info_stus\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt\": {\r\n            \"table_name\": \"prfl_org_enrlt\",\r\n            \"primary_key_col\": [\"org_enrlt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\"auth_rep_sgnr_nm\", \"auth_rep_sgnr_title\"],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt_stus_ref\": {\r\n            \"table_name\": \"prfl_org_enrlt_stus_ref\",\r\n            \"primary_key_col\": [\"org_enrlt_stus_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt_typ_ref\": {\r\n            \"table_name\": \"prfl_org_enrlt_typ_ref\",\r\n            \"primary_key_col\": [\"org_enrlt_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_org_enrlt_user\": {\r\n            \"table_name\": \"prfl_org_enrlt_user\",\r\n            \"primary_key_col\": [\"org_enrlt_user_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\"emailaddr_txt\": \"email\"},\r\n            \"exclude_cols\": [\"frst_nm_txt\", \"last_nm_txt\"],\r\n            \"s3_target_write_folder\": \"prfl/prfl_org_enrlt_user\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prfl_pref\": {\r\n            \"table_name\": \"prfl_prfl_pref\",\r\n            \"primary_key_col\": [\"prfl_pref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prfl_pref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prfl_pref_qstn_ref\": {\r\n            \"table_name\": \"prfl_prfl_pref_qstn_ref\",\r\n            \"primary_key_col\": [\"prfl_pref_qstn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prfl_pref_qstn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prfl_stus_ref\": {\r\n            \"table_name\": \"prfl_prfl_stus_ref\",\r\n            \"primary_key_col\": [\"prfl_stus_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prfl_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn\": {\r\n            \"table_name\": \"prfl_prsn\",\r\n            \"primary_key_col\": [\"prsn_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\"emailaddr_txt\": \"email\", \"phnnum_txt\": \"phone_num\"},\r\n            \"exclude_cols\": [\r\n                \"faxnum_txt\",\r\n                \"frst_nm_txt\",\r\n                \"last_nm_txt\",\r\n                \"mnm1_txt\",\r\n                \"phnext_txt\"],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_acct_xref\": {\r\n            \"table_name\": \"prfl_prsn_acct_xref\",\r\n            \"primary_key_col\": [\"prsn_acct_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_acct_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_org_cntct_typ_app_xref\": {\r\n            \"table_name\": \"prfl_prsn_org_cntct_typ_app_xref\",\r\n            \"primary_key_col\": [\"prsn_org_cntct_typ_app_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_org_cntct_typ_app_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_org_prsn_updt_audt\": {\r\n            \"table_name\": \"prfl_prsn_org_prsn_updt_audt\",\r\n            \"primary_key_col\": [\"prsn_org_prsn_updt_audt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\"audt_user_fnm\", \"audt_user_lnm\"],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_org_prsn_updt_audt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_prsn_org_xref\": {\r\n            \"table_name\": \"prfl_prsn_org_xref\",\r\n            \"primary_key_col\": [\"prsn_org_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_prsn_org_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_resp_formt_ref\": {\r\n            \"table_name\": \"prfl_resp_formt_ref\",\r\n            \"primary_key_col\": [\"resp_formt_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_resp_formt_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"prfl_st_user_id_rlshp\": {\r\n            \"table_name\": \"prfl_st_user_id_rlshp\",\r\n            \"primary_key_col\": [\"st_user_id_rlshp_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"prfl/prfl_st_user_id_rlshp\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_actn_ref\": {\r\n            \"table_name\": \"audt_actn_ref\",\r\n            \"primary_key_col\": [\"actn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_actn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_application_typ_ref\": {\r\n            \"table_name\": \"audt_application_typ_ref\",\r\n            \"primary_key_col\": [\"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_application_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_audt\": {\r\n            \"table_name\": \"audt_audt\",\r\n            \"primary_key_col\": [\"audt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\"ssn\": \"ssn\"},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_audt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_btch_oper_typ_ref\": {\r\n            \"table_name\": \"audt_btch_oper_typ_ref\",\r\n            \"primary_key_col\": [\"btch_oper_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_btch_oper_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_page_typ_ref\": {\r\n            \"table_name\": \"audt_page_typ_ref\",\r\n            \"primary_key_col\": [\"page_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_page_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_prc_ref\": {\r\n            \"table_name\": \"audt_prc_ref\",\r\n            \"primary_key_col\": [\"prc_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_prc_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_state_ref\": {\r\n            \"table_name\": \"audt_state_ref\",\r\n            \"primary_key_col\": [\"state_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_state_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"audt_tracking\": {\r\n            \"table_name\": \"audt_tracking\",\r\n            \"primary_key_col\": [\"tracking_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"audt/audt_tracking\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_account_locations\": {\r\n            \"table_name\": \"ptl_account_locations\",\r\n            \"primary_key_col\": [\"org_prfl_uid\", \"state_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_account_locations\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_account_status_ref\": {\r\n            \"table_name\": \"ptl_account_status_ref\",\r\n            \"primary_key_col\": [\"account_status_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_account_status_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_action_typ_ref\": {\r\n            \"table_name\": \"ptl_action_typ_ref\",\r\n            \"primary_key_col\": [\"action_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_action_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_addr_typ_ref\": {\r\n            \"table_name\": \"ptl_addr_typ_ref\",\r\n            \"primary_key_col\": [\"addr_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_addr_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_alternative_org_address\": {\r\n            \"table_name\": \"ptl_alternative_org_address\",\r\n            \"primary_key_col\": [\"alt_addr_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_alternative_org_address\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_alternative_org_address_typ\": {\r\n            \"table_name\": \"ptl_alternative_org_address_typ\",\r\n            \"primary_key_col\": [\"addr_typ_cd\", \"alt_addr_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_alternative_org_address_typ\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_app_clsfn_ref\": {\r\n            \"table_name\": \"ptl_app_clsfn_ref\",\r\n            \"primary_key_col\": [\"app_clsfn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_app_clsfn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_contact\": {\r\n            \"table_name\": \"ptl_contact\",\r\n            \"primary_key_col\": [\"contact_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {\r\n                \"contact_email_txt\": \"email\",\r\n                \"contact_phone_num\": \"phone_num\",\r\n                \"Intl_phone_num\": \"phone_num\"},\r\n            \"exclude_cols\": [\r\n                \"contact_fax_num\",\r\n                \"contact_nm\",\r\n                \"contact_phone_ext_num\",\r\n                \"Intl_fax_num\"],\r\n            \"s3_target_write_folder\": \"ptl/ptl_contact\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_contact_typ_ref\": {\r\n            \"table_name\": \"ptl_contact_typ_ref\",\r\n            \"primary_key_col\": [\"contact_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_contact_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_country_ref\": {\r\n            \"table_name\": \"ptl_country_ref\",\r\n            \"primary_key_col\": [\"country_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_country_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_empr_certn_elgt_stus_ref\": {\r\n            \"table_name\": \"ptl_empr_certn_elgt_stus_ref\",\r\n            \"primary_key_col\": [\"empr_certn_elgt_stus_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_empr_certn_elgt_stus_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_prfl\": {\r\n            \"table_name\": \"ptl_org_prfl\",\r\n            \"primary_key_col\": [\"org_prfl_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\"Intl_phone_num\"],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_prfl\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_prfl_addr_typ\": {\r\n            \"table_name\": \"ptl_org_prfl_addr_typ\",\r\n            \"primary_key_col\": [\"org_prfl_uid\", \"addr_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_prfl_addr_typ\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_prfl_vrfn_cd_ref\": {\r\n            \"table_name\": \"ptl_org_prfl_vrfn_cd_ref\",\r\n            \"primary_key_col\": [\"prfl_vrfn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_prfl_vrfn_cd_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_relationship\": {\r\n            \"table_name\": \"ptl_org_relationship\",\r\n            \"primary_key_col\": [\r\n                \"child_org_prfl_uid\",\r\n                \"parent_org_prfl_uid\",\r\n                \"org_relationship_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_relationship_typ_ref\": {\r\n            \"table_name\": \"ptl_org_relationship_typ_ref\",\r\n            \"primary_key_col\": [\"org_relationship_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_relationship_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_resplt\": {\r\n            \"table_name\": \"ptl_org_resplt\",\r\n            \"primary_key_col\": [\"org_resplt_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_resplt\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_resplt_ref\": {\r\n            \"table_name\": \"ptl_org_resplt_ref\",\r\n            \"primary_key_col\": [\"org_resplt_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_resplt_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_role_app_relationship\": {\r\n            \"table_name\": \"ptl_org_role_app_relationship\",\r\n            \"primary_key_col\": [\"application_typ_cd\", \"org_role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_role_typ_ref\": {\r\n            \"table_name\": \"ptl_org_role_typ_ref\",\r\n            \"primary_key_col\": [\"org_role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_org_role_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_typ_ref_org_resplt_ref_xref\": {\r\n            \"table_name\": \"ptl_org_typ_ref_org_resplt_ref_xref\",\r\n            \"primary_key_col\": [\"org_typ_ref_org_resplt_ref_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\":\r\n                \"ptl/ptl_org_typ_ref_org_resplt_ref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_org_typ_ref_org_role_typ_ref_xref\": {\r\n            \"table_name\": \"ptl_org_typ_ref_org_role_typ_ref_xref\",\r\n            \"primary_key_col\": [\"org_typ_ref_org_role_typ_ref_xref_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\":\r\n                \"ptl/ptl_org_typ_ref_org_role_typ_ref_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_page_typ_ref\": {\r\n            \"table_name\": \"ptl_page_typ_ref\",\r\n            \"primary_key_col\": [\"page_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_page_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_prfl_role_app_relationship\": {\r\n            \"table_name\": \"ptl_prfl_role_app_relationship\",\r\n            \"primary_key_col\": [\r\n                \"org_role_typ_cd\",\r\n                \"role_typ_cd\",\r\n                \"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_prfl_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_role_app_relationship\": {\r\n            \"table_name\": \"ptl_role_app_relationship\",\r\n            \"primary_key_col\": [\"role_typ_cd\", \"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_role_page_relationship\": {\r\n            \"table_name\": \"ptl_role_page_relationship\",\r\n            \"primary_key_col\": [\"role_typ_cd\", \"page_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_role_page_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_role_typ_ref\": {\r\n            \"table_name\": \"ptl_role_typ_ref\",\r\n            \"primary_key_col\": [\"role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_role_typ_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_state_county_ref\": {\r\n            \"table_name\": \"ptl_state_county_ref\",\r\n            \"primary_key_col\": [\"state_cd\", \"county_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_state_county_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_state_role_app_relationship\": {\r\n            \"table_name\": \"ptl_state_role_app_relationship\",\r\n            \"primary_key_col\": [\r\n                \"state_cd\",\r\n                \"role_typ_cd\",\r\n                \"application_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_state_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_account\": {\r\n            \"table_name\": \"ptl_user_account\",\r\n            \"primary_key_col\": [\"user_account_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [\r\n                \"birth_dt\",\r\n                \"social_security_num\",\r\n                \"social_security_num_old\",\r\n                \"user_first_nm\",\r\n                \"user_last_nm\",\r\n                \"user_middle_nm\"],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_account\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_affiln_ref\": {\r\n            \"table_name\": \"ptl_user_affiln_ref\",\r\n            \"primary_key_col\": [\"user_affiln_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_affiln_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_affiln_subfn_ref\": {\r\n            \"table_name\": \"ptl_user_affiln_subfn_ref\",\r\n            \"primary_key_col\": [\"user_affiln_subfn_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_affiln_subfn_ref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_afiln_subfn_role_typ_xref\": {\r\n            \"table_name\": \"ptl_user_afiln_subfn_role_typ_xref\",\r\n            \"primary_key_col\": [\"user_affiln_subfn_cd\", \"role_typ_cd\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_afiln_subfn_role_typ_xref\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_org_relationship\": {\r\n            \"table_name\": \"ptl_user_org_relationship\",\r\n            \"primary_key_col\": [\"org_prfl_uid\", \"user_account_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_org_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        },\r\n        \"ptl_user_role_app_relationship\": {\r\n            \"table_name\": \"ptl_user_role_app_relationship\",\r\n            \"primary_key_col\": [\r\n                \"role_typ_cd\",\r\n                \"application_typ_cd\",\r\n                \"user_account_uid\"],\r\n            \"partition_cols\": [],\r\n            \"pii_col\": {},\r\n            \"exclude_cols\": [],\r\n            \"s3_target_write_folder\": \"ptl/ptl_user_role_app_relationship\",\r\n            \"date_trns_cols\": {},\r\n            \"ts_trns_cols\": {},\r\n            \"rename_cols\": {}\r\n        }\r\n    }\r\n\r\n    # Get Job arguments to be passed to process the raw data\r\n    args = (getResolvedOptions(sys.argv, [\"JOB_NAME\", \"envname\",\r\n            \"deid_tbl_name\", 'dataset_name', 'source_db', 'target_db'])\r\n            )\r\n\r\n    # target_folder = args['target_folder_name']\r\n    # Target folder name to write the delta files\r\n    env_name = args['envname']  # Environment Name\r\n    global pii_lkup_table\r\n    pii_lkup_table = args['deid_tbl_name']  # Dynamo db lookup table name\r\n    dataset_nm = args['dataset_name']  # Dataset name to be processed\r\n    source_db = args['source_db']  # Source database name - Raw Layer\r\n    target_db = args['target_db']  # target_db database name - Clean Layer\r\n    print('source_db: {0} , dataset_nm: {1}  , env_name: {2}, target_db : {3} '\r\n          .format(source_db, dataset_nm, env_name, target_db))\r\n\r\n    sc = SparkContext()\r\n    glueContext = GlueContext(sc)\r\n    spark = glueContext.spark_session\r\n    print(spark)\r\n    job = Job(glueContext)\r\n    job.init(args[\"JOB_NAME\"]+'_'+dataset_nm, args)\r\n\r\n    # Load dataset config dictionary\r\n    dataset_dict_obj = datasetParamDict.get(dataset_nm)\r\n    print(dataset_dict_obj)\r\n    # Target folder name to write the delta files\r\n    target_folder = dataset_dict_obj.get(\"s3_target_write_folder\")\r\n    bucket_name = \"s3://ocse-\"+env_name+\"-da-main-deidentified-data/glue-db/\"\r\n    # Complete path to write the delta files\r\n    fld_path = bucket_name + target_folder+\"/\"\r\n    partition_cols_list = dataset_dict_obj.get(\"partition_cols\")\r\n    print(\"partition_cols_list\", partition_cols_list)\r\n\r\n    # 1.Build Dynamic df and also dynamic transformation_ctx based on tbl name\r\n    dataset_ddf = glueContext.create_dynamic_frame.from_catalog(\r\n        database=source_db,\r\n        table_name=dataset_dict_obj.get(\"table_name\"),\r\n        transformation_ctx=dataset_dict_obj.get(\"table_name\")+\"_dff\",\r\n    )\r\n\r\n    print(\"record count after initial ddf load: \", dataset_ddf.count())\r\n\r\n    # Rename columns\r\n    rename_cols_dict = dataset_dict_obj.get(\"rename_cols\")\r\n    print(\"rename_cols==>\", rename_cols_dict)\r\n    dataset_df = renameColsOfDF(rename_cols_dict, dataset_ddf.toDF())\r\n\r\n    # 2.Drop the columns from dataframe as per PII guidelines.\r\n    exclude_cols = dataset_dict_obj.get(\"exclude_cols\")\r\n    print(exclude_cols)\r\n    dataset_df = excludeColsFromDF(exclude_cols, dataset_df)\r\n\r\n    # transormation of coumns ex: trim, remove hypn\r\n    trns_cols = dataset_dict_obj.get(\"char_rep_trns\", {})\r\n    print(trns_cols)\r\n    for col_nm, trns_format_list in trns_cols.items():\r\n        print(\"trns_format_list:\", trns_format_list)\r\n        print(\"col_nm:\", col_nm)\r\n        for trns_format in trns_format_list:\r\n            dataset_df = coltransform(trns_format, dataset_df, col_nm)\r\n    # dataset_df.show()\r\n\r\n    # 3.Convert date format from String to dd-MMM-yy\r\n    dict_date_trans_cols = dataset_dict_obj.get(\"date_trns_cols\", {})\r\n    dict_ts_trans_cols = dataset_dict_obj.get(\"ts_trns_cols\", {})\r\n    dataset_df.printSchema()\r\n\r\n    for col_nm, dt_format in dict_date_trans_cols.items():\r\n        print('col_nm : {0} and dt_format:{1}'.format(col_nm, dt_format))\r\n        # format only if column name present in dataframe schema - column list\r\n        if col_nm in dataset_df.columns:\r\n            dataset_df = dataset_df.withColumn(col_nm,\r\n                                               to_date(col(col_nm), dt_format))\r\n    for col_nm, ts_format in dict_ts_trans_cols.items():\r\n        print('col_nm : {0} and ts_format:{1}'.format(col_nm, ts_format))\r\n        # format only if column name present in dataframe schema - column list.\r\n        if col_nm in dataset_df.columns:\r\n            dataset_df = dataset_df.withColumn(col_nm,\r\n                                               to_timestamp(col(col_nm),\r\n                                                            ts_format)\r\n                                               )\r\n    # 4.Add audit information to dataframe\r\n    df_inc_raw = addAuditInfo(dataset_df)\r\n    print(\"size of inc dataframe\", df_inc_raw.count())\r\n\r\n    # 5.Process PII column - based on translation type.\r\n    pii_dict_mapping = dataset_dict_obj.get(\"pii_col\")\r\n    inc_df = processPIIData(pii_dict_mapping, df_inc_raw)\r\n    inc_df.printSchema()\r\n    inc_df.show(4)\r\n    print(\"Incremental workload record count is\", inc_df.count())\r\n\r\n    # 6.Get primary key and write delta files.\r\n    pk_key_list = (dataset_dict_obj.get(\"primary_key_col\"))\r\n    print(\"pk_key_list:\", pk_key_list)\r\n\r\n    # Get DataSink object update update updateBehavior.\r\n    result_sink = glueContext.getSink(\r\n        path=fld_path,\r\n        connection_type=\"s3\",\r\n        updateBehavior=\"LOG\",\r\n        partitionKeys=partition_cols_list,\r\n        compression=\"snappy\",\r\n        enableUpdateCatalog=True,\r\n        transformation_ctx=dataset_dict_obj.get(\"table_name\")+\"dff\",\r\n        # transformation_ctx=\"result_sink\"\r\n    )\r\n    result_sink.setCatalogInfo(\r\n        catalogDatabase=target_db,\r\n        catalogTableName=dataset_dict_obj.get(\"table_name\")\r\n    )\r\n    # Raw input format conversion from CSV/txt into Parquet.\r\n    result_sink.setFormat(\"glueparquet\")\r\n\r\n    if inc_df.count() > 0:\r\n        final_df = DynamicFrame.fromDF(\r\n            inc_df, glueContext, \"final_df\"\r\n        )\r\n\r\n        # Write the dataframe to AWS S3 bucket and,\r\n        # also update the Data Catalogue.\r\n        result_sink.writeFrame(final_df)\r\n    else:\r\n        print(\"zero records in the file\")\r\n\r\n    job.commit()\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    try:\r\n        main()\r\n    except Exception as e:\r\n        LOGGER.error(\"An unexpected error in main() occurred.\", exc_info=e)\r\n        sys.exit(1)\r\n"
}